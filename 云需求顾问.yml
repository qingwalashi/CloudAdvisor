app:
  description: äº‘éœ€æ±‚é¡¾é—®ï¼ˆäº‘æœåŠ¡é…ç½®åŠ©æ‰‹ï¼‰- æ™ºèƒ½çš„äº‘æœåŠ¡é…ç½®åŠ©æ‰‹ç³»ç»Ÿï¼Œé›†æˆå¤§æ¨¡å‹èƒ½åŠ›ï¼Œæ”¯æŒè‡ªç„¶è¯­è¨€éœ€æ±‚è§£æå’Œè‡ªåŠ¨é…ç½®æ¸…å•ç”Ÿæˆ
  icon: ğŸŒ¥ï¸
  icon_background: '#FFEAD5'
  mode: workflow
  name: äº‘éœ€æ±‚é¡¾é—®
  use_icon_as_answer_icon: false
dependencies:
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/deepseek:0.0.6@dd589dc093c8084925858034ab5ec1fdf0d33819f43226c2f8c4a749a9acbbb2
kind: app
version: 0.3.1
workflow:
  conversation_variables: []
  environment_variables: []
  features:
    file_upload:
      allowed_file_extensions:
      - .JPG
      - .JPEG
      - .PNG
      - .GIF
      - .WEBP
      - .SVG
      allowed_file_types:
      - image
      allowed_file_upload_methods:
      - local_file
      - remote_url
      enabled: false
      fileUploadConfig:
        audio_file_size_limit: 50
        batch_count_limit: 5
        file_size_limit: 15
        image_file_size_limit: 10
        video_file_size_limit: 100
        workflow_file_upload_limit: 10
      image:
        enabled: false
        number_limits: 3
        transfer_methods:
        - local_file
        - remote_url
      number_limits: 3
    opening_statement: æ¬¢è¿ä½¿ç”¨äº‘éœ€æ±‚é¡¾é—®ï¼è¯·æè¿°æ‚¨çš„äº‘æœåŠ¡éœ€æ±‚ï¼Œæˆ‘å°†ä¸ºæ‚¨ç”Ÿæˆè¯¦ç»†çš„é…ç½®æ¸…å•ã€‚
    retriever_resource:
      enabled: false
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions:
    - æˆ‘éœ€è¦2å°äº‘æœåŠ¡å™¨ï¼Œ4æ ¸8GBé…ç½®
    - æ­å»ºä¸€ä¸ªç”µå•†ç½‘ç«™ï¼Œéœ€è¦é«˜å¯ç”¨æ¶æ„
    - å¼€å‘ç¯å¢ƒéœ€è¦MySQLæ•°æ®åº“å’Œåº”ç”¨æœåŠ¡å™¨
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
      language: ''
      voice: ''
  graph:
    edges:
    - data:
        sourceType: start
        targetType: code
      id: start-config
      source: start
      sourceHandle: source
      target: config_manager
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        sourceType: code
        targetType: code
      id: config-rules
      source: config_manager
      sourceHandle: source
      target: rules_loader
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        sourceType: code
        targetType: llm
      id: rules-llm
      source: rules_loader
      sourceHandle: source
      target: llm
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        sourceType: llm
        targetType: code
      id: llm-process
      source: llm
      sourceHandle: source
      target: process
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        sourceType: code
        targetType: code
      id: process-generate
      source: process
      sourceHandle: source
      target: generate
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        sourceType: code
        targetType: end
      id: generate-end
      source: generate
      sourceHandle: source
      target: end
      targetHandle: target
      type: custom
      zIndex: 0
    nodes:
    - data:
        desc: ç”¨æˆ·è¾“å…¥èŠ‚ç‚¹ - æ¥æ”¶ç”¨æˆ·çš„äº‘æœåŠ¡éœ€æ±‚æè¿°ï¼Œæ”¯æŒè‡ªç„¶è¯­è¨€è¾“å…¥å„ç§äº‘æœåŠ¡é…ç½®éœ€æ±‚
        selected: false
        title: éœ€æ±‚è¾“å…¥
        type: start
        variables:
        - label: ç”¨æˆ·éœ€æ±‚
          max_length: 1000
          options: []
          required: true
          type: text-input
          variable: user_requirement
      height: 118
      id: start
      position:
        x: 30
        y: 272
      positionAbsolute:
        x: 30
        y: 272
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        code: "def main() -> dict:\n    \"\"\"é…ç½®ç®¡ç†èŠ‚ç‚¹ - å­˜å‚¨æ‰€æœ‰è§„åˆ™é…ç½®\"\"\"\n    config\
          \ = {\n        \"version\": \"1.0\",\n        \"last_updated\": \"2025-08-03\"\
          ,\n        \"description\": \"åŠ¨æ€è§„åˆ™åº“é…ç½®\",\n\n        \"analysis_rules\":\
          \ {\n            \"server_counting\": {\n                \"description\"\
          : \"æœåŠ¡å™¨æ•°é‡ç»Ÿè®¡è§„åˆ™\",\n                \"priority\": \"high\",\n            \
          \    \"rules\": [\n                    \"é»˜è®¤ä¸€ä¸ªéœ€æ±‚æ˜¯ä¸€ä¸ªåº”ç”¨ç³»ç»Ÿï¼Œé™¤éç”¨æˆ·éœ€æ±‚è¡¨è¿°å¤šä¸ªåº”ç”¨ç³»ç»Ÿ\"\
          ,\n                    \"ä»”ç»†ç»Ÿè®¡æ¯ä¸ªåº”ç”¨ç³»ç»Ÿçš„æœåŠ¡å™¨æ€»æ•°é‡ï¼ŒåŒ…æ‹¬åº”ç”¨æœåŠ¡å™¨ã€æ•°æ®åº“æœåŠ¡å™¨ã€RedisæœåŠ¡å™¨ç­‰æ‰€æœ‰ç±»å‹çš„æœåŠ¡å™¨\"\
          ,\n                    \"æ¯å°æœåŠ¡å™¨éƒ½éœ€è¦å¯¹åº”çš„ECSäº‘æœåŠ¡å™¨å®ä¾‹\",\n                    \"\
          æ•°æ®åº“ã€Redisè½¯ä»¶ç­‰éƒ½éœ€è¦å®‰è£…åœ¨ECSäº‘æœåŠ¡å™¨ä¸Š\",\n                    \"é«˜å¯ç”¨æ¶æ„è‡³å°‘éœ€è¦2å°æœåŠ¡å™¨\"\n\
          \                ]\n            },\n            \"service_mapping\": {\n\
          \                \"description\": \"æœåŠ¡æ˜ å°„è§„åˆ™\",\n                \"priority\"\
          : \"high\",\n                \"rules\": [\n                    \"æ¯ä¸ªåº”ç”¨ç³»ç»Ÿé»˜è®¤é€šè¿‡äº’è”ç½‘æä¾›æœåŠ¡\"\
          ,\n                    \"æ¯ä¸ªåº”ç”¨ç³»ç»Ÿé…ç½®1ä¸ªå¼¹æ€§å…¬ç½‘IPï¼ˆé»˜è®¤10Må¸¦å®½ï¼‰\",\n                \
          \    \"æ¯ä¸ªåº”ç”¨ç³»ç»Ÿé€šå¸¸åªéœ€è¦1ä¸ªè´Ÿè½½å‡è¡¡SLBï¼Œï¼Œé™¤éæ˜ç¡®è¦æ±‚å¤šä¸ª\",\n                    \"æ¯ä¸ªECSäº‘æœåŠ¡å™¨é»˜è®¤1å—100Gç³»ç»Ÿç›˜ï¼Œæ— æ•°æ®ç›˜\"\
          \n                ]\n            },\n        },\n\n        \"service_types\"\
          : {\n            \"ecs\": {\n                \"name\": \"äº‘æœåŠ¡å™¨\",\n     \
          \           \"description\": \"æ¯å°é»˜è®¤é…ç½®100GBç³»ç»Ÿç›˜\",\n                \"category\"\
          : \"compute\",\n                \"mandatory\": True,\n                \"\
          auto_provision\": False,\n                \"specs\": [\n               \
          \     {\"name\": \"ecs.t5.small\", \"display\": \"é€šç”¨å‹ 2æ ¸4GB\", \"cpu\":\
          \ 2, \"memory\": 4},\n                    {\"name\": \"ecs.t5.medium\",\
          \ \"display\": \"é€šç”¨å‹ 4æ ¸8GB\", \"cpu\": 4, \"memory\": 8},\n            \
          \        {\"name\": \"ecs.c5.large\", \"display\": \"è®¡ç®—ä¼˜åŒ–å‹ 8æ ¸16GB\", \"\
          cpu\": 8, \"memory\": 16}\n                ]\n            },\n         \
          \   \"system_disk\": {\n                \"name\": \"ç³»ç»Ÿç›˜\",\n           \
          \     \"description\": \"é»˜è®¤100GBï¼ŒæŒ‰50GBé€’å¢\",\n                \"category\"\
          : \"storage\",\n                \"mandatory\": False,\n                \"\
          auto_provision\": True,\n                \"default_size\": 100,\n      \
          \          \"increment\": 50,\n                \"max_size\": 1000\n    \
          \        },\n            \"data_disk\": {\n                \"name\": \"\
          æ•°æ®ç›˜\",\n                \"description\": \"æ¯å°æœåŠ¡å™¨æœ€å¤š1å—ï¼ŒæŒ‰50GBé€’å¢\",\n      \
          \          \"category\": \"storage\",\n                \"mandatory\": False,\n\
          \                \"auto_provision\": False,\n                \"min_size\"\
          : 50,\n                \"increment\": 50,\n                \"max_size\"\
          : 2000,\n                \"max_per_server\": 1\n            },\n       \
          \     \"eip\": {\n                \"name\": \"å¼¹æ€§å…¬ç½‘IP\",\n              \
          \  \"description\": \"å¸¦å®½é€‰é¡¹ï¼š10M/20M/50M/100M/200M\",\n                \"\
          category\": \"network\",\n                \"mandatory\": False,\n      \
          \          \"auto_provision\": True,\n                \"bandwidth_options\"\
          : [10, 20, 50, 100, 200],\n                \"default_bandwidth\": 10\n \
          \           },\n            \"slb\": {\n                \"name\": \"è´Ÿè½½å‡è¡¡SLB\"\
          ,\n                \"description\": \"è§„æ ¼åŒ¹é…å‡ºå£å¸¦å®½ï¼š10M/20M/50M/100M/200M\",\n\
          \                \"category\": \"network\",\n                \"mandatory\"\
          : False,\n                \"auto_provision\": False,\n                \"\
          recommended\": True,\n                \"bandwidth_options\": [10, 20, 50,\
          \ 100, 200],\n            },\n            \"bastion_host\": {\n        \
          \        \"name\": \"å ¡å’æœº\",\n                \"description\": \"ECSå¿…é¡»é…ç½®ï¼Œæ ¹æ®æœåŠ¡å™¨æ•°é‡è‡ªåŠ¨é€‰æ‹©è§„æ ¼\"\
          ,\n                \"category\": \"security\",\n                \"mandatory\"\
          : True,\n                \"auto_provision\": True,\n                \"specs\"\
          : [\n                    {\"name\": \"license_1\", \"display\": \"1æœåŠ¡å™¨æˆæƒ\"\
          , \"max_servers\": 1},\n                    {\"name\": \"license_10\", \"\
          display\": \"10æœåŠ¡å™¨æˆæƒ\", \"max_servers\": 10},\n                    {\"name\"\
          : \"license_20\", \"display\": \"20æœåŠ¡å™¨æˆæƒ\", \"max_servers\": 20},\n    \
          \                {\"name\": \"license_50\", \"display\": \"50æœåŠ¡å™¨æˆæƒ\", \"\
          max_servers\": 50}\n                ]\n            },\n            \"host_security\"\
          : {\n                \"name\": \"ä¸»æœºå®‰å…¨\",\n                \"description\"\
          : \"ECSå¿…é¡»é…ç½®ï¼Œæ ¹æ®æœåŠ¡å™¨æ•°é‡è‡ªåŠ¨é€‰æ‹©è§„æ ¼\",\n                \"category\": \"security\"\
          ,\n                \"mandatory\": True,\n                \"auto_provision\"\
          : True,\n                \"specs\": [\n                    {\"name\": \"\
          license_1\", \"display\": \"1æœåŠ¡å™¨æˆæƒ\", \"max_servers\": 1},\n           \
          \         {\"name\": \"license_10\", \"display\": \"10æœåŠ¡å™¨æˆæƒ\", \"max_servers\"\
          : 10},\n                    {\"name\": \"license_20\", \"display\": \"20æœåŠ¡å™¨æˆæƒ\"\
          , \"max_servers\": 20},\n                    {\"name\": \"license_50\",\
          \ \"display\": \"50æœåŠ¡å™¨æˆæƒ\", \"max_servers\": 50}\n                ]\n  \
          \          }\n        },\n\n        \"environment_config\": {\n        \
          \    \"storage_type\": \"HDDé«˜é€Ÿäº‘ç›˜\",\n            \"datacenter\": \"ç»Ÿä¸€æœºæˆ¿ï¼Œæ— åœ°åŸŸåŒºåˆ†\"\
          ,\n            \"internet_access\": \"åº”ç”¨ç³»ç»Ÿé»˜è®¤é€šè¿‡äº’è”ç½‘æä¾›æœåŠ¡\",\n        },\n\n\
          \        \"analysis_steps\": [\n            \"è¯†åˆ«åº”ç”¨ç³»ç»Ÿæ•°é‡\",\n            \"\
          è¯†åˆ«æ¯ä¸ªåº”ç”¨ç³»ç»Ÿæ‰€æœ‰ç±»å‹çš„æœåŠ¡å™¨åŠå…¶æ•°é‡\",\n            \"è®¡ç®—ECSæ€»æ•°é‡ï¼ˆç­‰äºæ‰€æœ‰æœåŠ¡å™¨æ•°é‡ä¹‹å’Œï¼‰\",\n      \
          \      \"ç¡®å®šå­˜å‚¨éœ€æ±‚ï¼ˆç³»ç»Ÿç›˜ã€æ•°æ®ç›˜ï¼‰ï¼Œè®¡ç®—æ‰€æœ‰ECSå¯¹åº”çš„ç³»ç»Ÿç›˜æ€»å®¹é‡ã€è®¡ç®—æ•°æ®ç›˜æ€»å®¹é‡\"\n            \"è¯†åˆ«ç½‘ç»œæœåŠ¡éœ€æ±‚ï¼ˆSLBã€EIPã€å¸¦å®½ç­‰ï¼‰\"\
          ,\n            \"è¯†åˆ«å®‰å…¨æœåŠ¡éœ€æ±‚ï¼ˆå ¡å’æœºã€ä¸»æœºå®‰å…¨ç­‰ï¼‰\"\n            \"ç”Ÿæˆå®Œæ•´çš„æœåŠ¡æ¸…å•\"\n    \
          \    ],\n\n        \"validation_rules\": {\n            \"server_limits\"\
          : {\n                \"min_servers\": 1,\n                \"max_servers\"\
          : 50,\n            },\n            \"bandwidth_limits\": {\n           \
          \     \"min_bandwidth\": 10,\n                \"max_bandwidth\": 200,\n\
          \                \"default_bandwidth\": 10\n            },\n           \
          \ \"storage_limits\": {\n                \"min_system_disk\": 100,\n   \
          \             \"max_system_disk\": 1000,\n                \"min_data_disk\"\
          : 50,\n                \"max_data_disk\": 2000\n            }\n        }\n\
          \    }\n\n    return {\"config\": config}"
        code_language: python3
        desc: é…ç½®ç®¡ç†ä¸­å¿ƒ - é›†ä¸­å­˜å‚¨äº‘æœåŠ¡è§„åˆ™åº“ã€æœåŠ¡ç±»å‹å®šä¹‰ã€åˆ†æè§„åˆ™ç­‰æ ¸å¿ƒé…ç½®ï¼Œæ”¯æŒç‰ˆæœ¬ç®¡ç†å’ŒåŠ¨æ€æ›´æ–°
        outputs:
          config:
            children: null
            type: object
        selected: false
        title: è§„åˆ™é…ç½®ä¸­å¿ƒ
        type: code
        variables: []
      height: 98
      id: config_manager
      position:
        x: 334
        y: 272
      positionAbsolute:
        x: 334
        y: 272
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        code: "def main(user_requirement: str, config: dict) -> dict:\n    \"\"\"\
          åŠ¨æ€ç”Ÿæˆç³»ç»Ÿæç¤ºè¯å’Œè§„åˆ™\"\"\"\n    try:\n        # ä»é…ç½®ç®¡ç†èŠ‚ç‚¹è·å–é…ç½®æ•°æ®\n        rules_version\
          \ = config.get(\"version\", \"\")\n        last_updated = config.get(\"\
          last_updated\", \"\")\n        analysis_rules = config.get(\"analysis_rules\"\
          , {})\n        service_types = config.get(\"service_types\", {})\n     \
          \   environment_config = config.get(\"environment_config\", {})\n      \
          \  analysis_steps = config.get(\"analysis_steps\", [])\n\n        # æ£€æŸ¥å¿…éœ€çš„é…ç½®é¡¹ï¼Œå¦‚æœç¼ºå¤±åˆ™è¿”å›é”™è¯¯ä¿¡æ¯\n\
          \        missing_configs = []\n        if not analysis_rules:\n        \
          \    missing_configs.append(\"analysis_rules\")\n        if not service_types:\n\
          \            missing_configs.append(\"service_types\")\n        if not environment_config:\n\
          \            missing_configs.append(\"environment_config\")\n        if\
          \ not analysis_steps:\n            missing_configs.append(\"analysis_steps\"\
          )\n        \n        if missing_configs:\n            error_msg = f\"é…ç½®è¯»å–å¤±è´¥ï¼Œç¼ºå°‘ä»¥ä¸‹é…ç½®é¡¹:\
          \ {', '.join(missing_configs)}\"\n            return {\n               \
          \ \"prompt_data\": {\n                    \"system_prompt\": error_msg,\n\
          \                    \"user_prompt\": user_requirement,\n              \
          \      \"rules_version\": rules_version,\n                    \"error\"\
          : error_msg\n                }\n            }\n\n        # æ„å»ºç³»ç»Ÿæç¤ºè¯\n   \
          \     version_line = \"è§„åˆ™åº“ç‰ˆæœ¬: \" + str(rules_version) + \" (æ›´æ–°æ—¶é—´: \" + str(last_updated)\
          \ + \")\"\n\n        # æ„å»ºåˆ†æè§„åˆ™éƒ¨åˆ†\n        rules_section = \"é‡è¦åˆ†æè§„åˆ™ï¼š\"\n \
          \       for category, rule_data in analysis_rules.items():\n           \
          \ if isinstance(rule_data, dict) and 'rules' in rule_data:\n           \
          \     rules_section += \"\\\\n\" + rule_data.get('description', category)\
          \ + \":\"\n                for rule in rule_data['rules']:\n           \
          \         rules_section += \"\\\\n- \" + rule\n            else:\n     \
          \           rules_section += \"\\\\n- \" + str(rule_data)\n\n        # æ„å»ºæœåŠ¡ç±»å‹éƒ¨åˆ†\n\
          \        services_section = \"å¯ç”¨çš„æœåŠ¡ç±»å‹åŒ…æ‹¬ï¼š\"\n        for service_key, service_data\
          \ in service_types.items():\n            if isinstance(service_data, dict):\n\
          \                name = service_data.get('name', service_key)\n        \
          \        desc = service_data.get('description', '')\n                services_section\
          \ += \"\\\\n- \" + service_key + \": \" + name + \"ï¼ˆ\" + desc + \"ï¼‰\"\n\
          \            else:\n                services_section += \"\\\\n- \" + str(service_data)\n\
          \n        # æ„å»ºç¯å¢ƒè¯´æ˜éƒ¨åˆ†\n        env_section = \"é‡è¦æ³¨æ„äº‹é¡¹ï¼š\"\n        if isinstance(environment_config,\
          \ dict):\n            for key, value in environment_config.items():\n  \
          \              env_section += \"\\\\n- \" + str(value)\n        else:\n\
          \            env_section += \"\\\\n- \" + str(environment_config)\n\n  \
          \      # æ„å»ºåˆ†ææ­¥éª¤éƒ¨åˆ†\n        steps_section = \"åˆ†ææ­¥éª¤ï¼š\"\n        for i, step\
          \ in enumerate(analysis_steps):\n            steps_section += \"\\\\n\"\
          \ + str(i+1) + \". \" + step\n\n        # ç»„è£…å®Œæ•´æç¤ºè¯\n        system_prompt\
          \ = \"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„äº‘æœåŠ¡éœ€æ±‚åˆ†æå¸ˆã€‚è¯·ä»”ç»†åˆ†æç”¨æˆ·çš„äº‘æœåŠ¡éœ€æ±‚ï¼Œå‡†ç¡®è¯†åˆ«æ¯ç§æœåŠ¡çš„æ•°é‡ï¼Œå¹¶ä»¥JSONæ ¼å¼è¿”å›ç»“æ„åŒ–çš„éœ€æ±‚ä¿¡æ¯ã€‚\\\\\
          n\\\\n\"\n        system_prompt += version_line + \"\\\\n\\\\n\"\n     \
          \   system_prompt += rules_section + \"\\\\n\\\\n\"\n        system_prompt\
          \ += \"è¯·æŒ‰ç…§ä»¥ä¸‹æ ¼å¼è¿”å›JSONï¼š\\\\n\"\n        system_prompt += '{\"success\": true,\
          \ \"application_count\": åº”ç”¨ç³»ç»Ÿæ•°é‡, \"compute_services\": [{\"service_type\"\
          : \"ecs\", \"quantity\": ECSæ•°é‡, \"specifications\": {\"spec_name\": \"è§„æ ¼åç§°\"\
          , \"cpu\": CPUæ ¸æ•°, \"memory\": å†…å­˜GB}, \"properties\": {\"environment\": \"\
          ç¯å¢ƒç±»å‹\", \"server_role\": \"æœåŠ¡å™¨è§’è‰²\"}, \"reason\": \"é€‰æ‹©ç†ç”±\"}], \"storage_services\"\
          : [{\"service_type\": \"system_disk\", \"quantity\": ç³»ç»Ÿç›˜æ•°é‡, \"specifications\"\
          : {\"size\": å®¹é‡GB, \"disk_type\": \"ç£ç›˜ç±»å‹\"}, \"properties\": {\"total_capacity\"\
          : æ€»å®¹é‡GB}, \"reason\": \"é€‰æ‹©ç†ç”±\"}, {\"service_type\": \"data_disk\", \"quantity\"\
          : æ•°æ®ç›˜æ•°é‡, \"specifications\": {\"size\": å®¹é‡GB, \"disk_type\": \"ç£ç›˜ç±»å‹\"},\
          \ \"properties\": {\"total_capacity\": æ€»å®¹é‡GB}, \"reason\": \"é€‰æ‹©ç†ç”±\"}], \"\
          network_services\": [{\"service_type\": \"eip\", \"quantity\": å¼¹æ€§IPæ•°é‡, \"\
          specifications\": {\"bandwidth\": å¸¦å®½Mbps}, \"properties\": {\"usage\": \"\
          ç”¨é€”è¯´æ˜\"}, \"reason\": \"é€‰æ‹©ç†ç”±\"}, {\"service_type\": \"slb\", \"quantity\"\
          : è´Ÿè½½å‡è¡¡æ•°é‡, \"specifications\": {\"bandwidth\": å¸¦å®½Mbps}, \"properties\": {\"\
          usage\": \"ç”¨é€”è¯´æ˜\"}, \"reason\": \"é€‰æ‹©ç†ç”±\"}], \"security_services\": [{\"\
          service_type\": \"bastion_host\", \"quantity\": å ¡å’æœºæ•°é‡, \"specifications\"\
          : {\"spec_name\": \"è§„æ ¼åç§°\", \"max_servers\": æ”¯æŒæœåŠ¡å™¨æ•°}, \"properties\": {\"\
          coverage\": \"è¦†ç›–èŒƒå›´\"}, \"reason\": \"é€‰æ‹©ç†ç”±\"}, {\"service_type\": \"host_security\"\
          , \"quantity\": ä¸»æœºå®‰å…¨æ•°é‡, \"specifications\": {\"spec_name\": \"è§„æ ¼åç§°\", \"\
          max_servers\": æ”¯æŒæœåŠ¡å™¨æ•°}, \"properties\": {\"coverage\": \"è¦†ç›–èŒƒå›´\"}, \"reason\"\
          : \"é€‰æ‹©ç†ç”±\"}], \"requirements_summary\": \"éœ€æ±‚æ€»ç»“ï¼ŒåŒ…å«åº”ç”¨ç³»ç»Ÿæ•°é‡å’ŒæœåŠ¡å™¨æ€»æ•°ç»Ÿè®¡\", \"total_servers\"\
          : æœåŠ¡å™¨æ€»æ•°é‡, \"server_breakdown\": {\"application_servers\": åº”ç”¨æœåŠ¡å™¨æ•°é‡, \"database_servers\"\
          : æ•°æ®åº“æœåŠ¡å™¨æ•°é‡, \"cache_servers\": ç¼“å­˜æœåŠ¡å™¨æ•°é‡, \"other_servers\": å…¶ä»–æœåŠ¡å™¨æ•°é‡}, \"\
          special_requirements\": [\"ç‰¹æ®Šéœ€æ±‚åˆ—è¡¨\"]}'\n        system_prompt += \"\\\\\
          n\\\\n\" + services_section + \"\\\\n\\\\n\"\n        system_prompt += env_section\
          \ + \"\\\\n\\\\n\"\n        system_prompt += steps_section + \"\\\\n\\\\\
          n\"\n        system_prompt += \"è¯·ä»”ç»†åˆ†æç”¨æˆ·éœ€æ±‚ï¼Œå‡†ç¡®è®¡ç®—åº”ç”¨ç³»ç»Ÿæ•°é‡ã€æœåŠ¡å™¨è§„æ ¼ä¸æ•°é‡ã€å­˜å‚¨è§„æ ¼ä¸æ•°é‡ã€ç½‘ç»œæœåŠ¡è§„æ ¼ä¸æ•°é‡ã€å®‰å…¨æœåŠ¡è§„æ ¼ä¸æ•°é‡ï¼Œå¹¶ç»™å‡ºåˆç†çš„é…ç½®å»ºè®®ã€‚\"\
          \n        \n        return {\n            \"prompt_data\": {\n         \
          \       \"system_prompt\": system_prompt,\n                \"user_prompt\"\
          : user_requirement,\n                \"rules_version\": rules_version\n\
          \            }\n        }\n    except Exception as e:\n        return {\n\
          \            \"prompt_data\": {\n                \"system_prompt\": \"ç³»ç»Ÿæç¤ºè¯ç”Ÿæˆå¤±è´¥\"\
          ,\n                \"user_prompt\": user_requirement,\n                \"\
          rules_version\": \"unknown\",\n                \"error\": str(e)\n     \
          \       }\n        }"
        code_language: python3
        desc: æ™ºèƒ½æç¤ºè¯ç”Ÿæˆå™¨ - åŸºäºé…ç½®ç®¡ç†ä¸­å¿ƒçš„è§„åˆ™åº“åŠ¨æ€æ„å»ºAIåˆ†ææç¤ºè¯ï¼Œç¡®ä¿åˆ†æå‡†ç¡®æ€§å’Œä¸€è‡´æ€§
        outputs:
          prompt_data:
            children: null
            type: object
        selected: false
        title: æç¤ºè¯æ„å»ºå™¨
        type: code
        variables:
        - value_selector:
          - start
          - user_requirement
          variable: user_requirement
        - value_selector:
          - config_manager
          - config
          variable: config
      height: 82
      id: rules_loader
      position:
        x: 638
        y: 272
      positionAbsolute:
        x: 638
        y: 272
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: AIéœ€æ±‚åˆ†æå¼•æ“ - ä½¿ç”¨DeepSeekå¤§æ¨¡å‹åŸºäºåŠ¨æ€æç¤ºè¯æ™ºèƒ½è§£æç”¨æˆ·éœ€æ±‚ï¼Œè¾“å‡ºç»“æ„åŒ–çš„äº‘æœåŠ¡é…ç½®æ–¹æ¡ˆ
        model:
          completion_params:
            temperature: 0.1
          mode: chat
          name: deepseek-chat
          provider: langgenius/deepseek/deepseek
        prompt_template:
        - id: system
          role: system
          text: '{{#rules_loader.prompt_data.system_prompt#}}'
        - id: user
          role: user
          text: '{{#rules_loader.prompt_data.user_prompt#}}'
        selected: false
        title: æ™ºèƒ½éœ€æ±‚åˆ†æ
        type: llm
        variables: []
        vision:
          enabled: false
      height: 118
      id: llm
      position:
        x: 942
        y: 272
      positionAbsolute:
        x: 942
        y: 272
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        code: "import json\nimport re\n\ndef main(llm_result, user_requirement) ->\
          \ dict:\n    \"\"\"å¤„ç†AIè§£æç»“æœ\"\"\"\n    try:\n        # æå–JSONå†…å®¹ï¼Œå¤„ç†markdownä»£ç å—æ ¼å¼\n\
          \        json_content = llm_result.strip()\n        \n        # å¦‚æœåŒ…å«markdownä»£ç å—ï¼Œæå–å…¶ä¸­çš„JSON\n\
          \        if '```json' in json_content:\n            # ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æå–JSONå†…å®¹\n\
          \            json_match = re.search(r'```json\\s*\\n(.*?)\\n```', json_content,\
          \ re.DOTALL)\n            if json_match:\n                json_content =\
          \ json_match.group(1).strip()\n        elif '```' in json_content:\n   \
          \         # å¤„ç†æ™®é€šä»£ç å—\n            json_match = re.search(r'```\\s*\\n(.*?)\\\
          n```', json_content, re.DOTALL)\n            if json_match:\n          \
          \      json_content = json_match.group(1).strip()\n        \n        # å°è¯•è§£æJSON\n\
          \        if json_content.startswith('{'):\n            parsed_data = json.loads(json_content)\n\
          \            if parsed_data.get('success', False):\n                summary\
          \ = parsed_data.get('requirements_summary', 'éœ€æ±‚å·²è§£æ')\n                \n\
          \                requirements = []\n                \n                #\
          \ å¤„ç†è®¡ç®—æœåŠ¡\n                compute_services = parsed_data.get('compute_services',\
          \ [])\n                for service_data in compute_services:\n         \
          \           service_type = service_data.get('service_type')\n          \
          \          if service_type:\n                        quantity = service_data.get('quantity',\
          \ 1)\n                        specifications = service_data.get('specifications',\
          \ {})\n                        properties = service_data.get('properties',\
          \ {})\n                        \n                        requirement = {\n\
          \                            'service': service_type,\n                \
          \            'spec': specifications.get('spec_name'),\n                \
          \            'quantity': quantity,\n                            'properties':\
          \ properties,\n                            'category': 'compute'\n     \
          \                   }\n                        requirements.append(requirement)\n\
          \                \n                # å¤„ç†å­˜å‚¨æœåŠ¡\n                storage_services\
          \ = parsed_data.get('storage_services', [])\n                for service_data\
          \ in storage_services:\n                    service_type = service_data.get('service_type')\n\
          \                    if service_type:\n                        quantity\
          \ = service_data.get('quantity', 1)\n                        specifications\
          \ = service_data.get('specifications', {})\n                        properties\
          \ = service_data.get('properties', {})\n                        \n     \
          \                   requirement = {\n                            'service':\
          \ service_type,\n                            'spec': specifications.get('size',\
          \ specifications.get('spec_name')),\n                            'quantity':\
          \ quantity,\n                            'properties': properties,\n   \
          \                         'category': 'storage'\n                      \
          \  }\n                        requirements.append(requirement)\n       \
          \         \n                # å¤„ç†ç½‘ç»œæœåŠ¡\n                network_services =\
          \ parsed_data.get('network_services', [])\n                for service_data\
          \ in network_services:\n                    service_type = service_data.get('service_type')\n\
          \                    if service_type:\n                        quantity\
          \ = service_data.get('quantity', 1)\n                        specifications\
          \ = service_data.get('specifications', {})\n                        properties\
          \ = service_data.get('properties', {})\n                        \n     \
          \                   requirement = {\n                            'service':\
          \ service_type,\n                            'spec': specifications.get('bandwidth',\
          \ specifications.get('spec_name')),\n                            'quantity':\
          \ quantity,\n                            'properties': properties,\n   \
          \                         'category': 'network'\n                      \
          \  }\n                        requirements.append(requirement)\n       \
          \         \n                # å¤„ç†å®‰å…¨æœåŠ¡\n                security_services\
          \ = parsed_data.get('security_services', [])\n                for service_data\
          \ in security_services:\n                    service_type = service_data.get('service_type')\n\
          \                    if service_type:\n                        quantity\
          \ = service_data.get('quantity', 1)\n                        specifications\
          \ = service_data.get('specifications', {})\n                        properties\
          \ = service_data.get('properties', {})\n                        \n     \
          \                   requirement = {\n                            'service':\
          \ service_type,\n                            'spec': specifications.get('spec_name'),\n\
          \                            'quantity': quantity,\n                   \
          \         'properties': properties,\n                            'category':\
          \ 'security'\n                        }\n                        requirements.append(requirement)\n\
          \                \n                # å¦‚æœæœ‰ä»»ä½•æœåŠ¡è¢«è§£æåˆ°ï¼Œè®¤ä¸ºè§£ææˆåŠŸ\n              \
          \  if requirements:\n                    return {\n                    \
          \    \"requirements\": {\"list\": requirements},\n                     \
          \   \"parse_info\": \"\U0001F916 AIè§£æ: \" + summary,\n                 \
          \       \"success\": \"true\"\n                    }\n\n        # AIè§£æå¤±è´¥\n\
          \        return {\n            \"requirements\": {\"list\": []},\n     \
          \       \"parse_info\": \"AIè§£æå¤±è´¥ï¼šæ— æ³•è¯†åˆ«æœ‰æ•ˆçš„æœåŠ¡é…ç½®\",\n            \"success\"\
          : \"false\"\n        }\n\n    except Exception as e:\n        return {\n\
          \            \"requirements\": {\"list\": []},\n            \"parse_info\"\
          : \"è§£æå¤±è´¥: \" + str(e),\n            \"success\": \"false\"\n        }"
        code_language: python3
        desc: ç»“æœå¤„ç†å™¨ - è§£æAIè¾“å‡ºçš„JSONç»“æœï¼Œæå–æœåŠ¡é…ç½®ä¿¡æ¯ï¼Œå¤„ç†å¼‚å¸¸æƒ…å†µå¹¶è¿›è¡Œæ•°æ®æ ‡å‡†åŒ–
        outputs:
          parse_info:
            children: null
            type: string
          requirements:
            children: null
            type: object
          success:
            children: null
            type: string
        selected: false
        title: ç»“æœè§£æå¤„ç†
        type: code
        variables:
        - value_selector:
          - llm
          - text
          variable: llm_result
        - value_selector:
          - start
          - user_requirement
          variable: user_requirement
      height: 98
      id: process
      position:
        x: 1246
        y: 272
      positionAbsolute:
        x: 1246
        y: 272
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        code: "import json\nfrom datetime import datetime\n\ndef select_security_spec(server_count):\n\
          \    \"\"\"æ ¹æ®æœåŠ¡å™¨æ•°é‡é€‰æ‹©å®‰å…¨æœåŠ¡è§„æ ¼\"\"\"\n    if server_count <= 1:\n        return\
          \ \"license_1\"\n    elif server_count <= 10:\n        return \"license_10\"\
          \n    elif server_count <= 20:\n        return \"license_20\"\n    else:\n\
          \        return \"license_50\"\n\ndef select_bandwidth_spec(requested_bandwidth):\n\
          \    \"\"\"æ ¹æ®è¯·æ±‚å¸¦å®½é€‰æ‹©æ ‡å‡†è§„æ ¼ï¼ˆå‘ä¸ŠåŒ¹é…ï¼‰\"\"\"\n    # é¢„ç½®çš„æ ‡å‡†å¸¦å®½è§„æ ¼\n\
          \    standard_bandwidths = [10, 20, 50, 100, 200]\n    \n    # å¦‚æœè¯·æ±‚å¸¦å®½ä¸ºç©ºæˆ–0ï¼Œè¿”å›é»˜è®¤10M\n\
          \    if not requested_bandwidth or requested_bandwidth <= 0:\n        return 10\n    \n    # å‘ä¸ŠåŒ¹é…ï¼šæ‰¾åˆ°ç¬¬ä¸€ä¸ªå¤§äºç­‰äºè¯·æ±‚å¸¦å®½çš„æ ‡å‡†è§„æ ¼\n\
          \    for bandwidth in standard_bandwidths:\n        if requested_bandwidth <= bandwidth:\n            return bandwidth\n    \n    # å¦‚æœè¶…è¿‡æœ€å¤§è§„æ ¼ï¼Œè¿”å›æœ€å¤§è§„æ ¼\n    return standard_bandwidths[-1]\n\ndef normalize_storage_spec(requested_size, is_system_disk=False):\n\
          \    \"\"\"æ ‡å‡†åŒ–å­˜å‚¨è§„æ ¼ï¼ŒæŒ‰50GBé€’å¢\"\"\"\n    if not requested_size or requested_size <= 0:\n        return 100 if is_system_disk else 50\n    \n    if is_system_disk:\n        # ç³»ç»Ÿç›˜ï¼š100GåŸºç¡€ä¸ŠæŒ‰50Gé€’å¢\n        if requested_size <= 100:\n            return 100\n        return 100 + ((requested_size - 100 - 1) // 50 + 1) * 50\n    else:\n        # æ•°æ®ç›˜ï¼šæŒ‰50GBé€’å¢\n        return ((requested_size - 1) // 50 + 1) * 50\n\ndef apply_mandatory_rules(requirements):\n\
          \    \"\"\"åº”ç”¨å¼ºåˆ¶ä¾èµ–è§„åˆ™\"\"\"\n    additional_services = []\n    total_ecs =\
          \ sum(req['quantity'] for req in requirements if req['service'] == 'ecs')\n\
          \n    if total_ecs > 0:\n        existing_services = {req['service'] for req in requirements}\n\
          \        \n        if 'system_disk' not in existing_services:\n        \
          \    additional_services.append({\n                'service': 'system_disk',\n\
          \                'spec': '100GB',\n                'quantity': total_ecs,\n\
          \                'properties': {'size': 100, 'disk_type': 'HDDé«˜é€Ÿäº‘ç›˜', 'total_capacity':\
          \ total_ecs * 100},\n                'auto_added': True,\n             \
          \   'reason': 'æ¯å°ECSé»˜è®¤é…ç½®100GBç³»ç»Ÿç›˜',\n                'category': 'storage'\n\
          \            })\n\n        if 'eip' not in existing_services:\n        \
          \    additional_services.append({\n                'service': 'eip',\n \
          \               'spec': '10M',\n                'quantity': 1,\n       \
          \         'properties': {'bandwidth': 10},\n                'auto_added':\
          \ True,\n                'reason': 'åº”ç”¨ç³»ç»Ÿå…¬ç½‘å‡ºå£å¿…éœ€',\n                'category':\
          \ 'network'\n            })\n\n        # å¼ºåˆ¶ä½¿ç”¨æœ€ä¼˜å®‰å…¨æœåŠ¡é…ç½®ï¼Œè¦†ç›–AIå¯èƒ½è¿”å›çš„é”™è¯¯é…ç½®\n        # è®¡ç®—å ¡å’æœºæœ€ä¼˜è§„æ ¼ç»„åˆ\n        bastion_specs = calculate_optimal_security_specs(total_ecs)\n        for spec_info in bastion_specs:\n            additional_services.append({\n                'service': 'bastion_host',\n                'spec': spec_info['spec'],\n                'quantity': spec_info['quantity'],\n                'properties': {'max_servers': spec_info['max_servers'], 'covers': spec_info['covers']},\n                'auto_added': True,\n                'reason': 'è¿ç»´å®‰å…¨å®¡è®¡è¦æ±‚',\n                'category': 'security'\n            })\n\n        # è®¡ç®—ä¸»æœºå®‰å…¨æœ€ä¼˜è§„æ ¼ç»„åˆ\n        host_security_specs = calculate_optimal_security_specs(total_ecs)\n        for spec_info in host_security_specs:\n            additional_services.append({\n                'service': 'host_security',\n                'spec': spec_info['spec'],\n                'quantity': spec_info['quantity'],\n                'properties': {'max_servers': spec_info['max_servers'], 'covers': spec_info['covers']},\n                'auto_added': True,\n                'reason': 'ä¸»æœºå®‰å…¨é˜²æŠ¤è¦æ±‚',\n                'category': 'security'\n            })\n\n    return additional_services\n\ndef normalize_bandwidth_specs(requirements_list):\n\
          \    \"\"\"æ ‡å‡†åŒ–å¸¦å®½è§„æ ¼ï¼Œç¡®ä¿ç¬¦åˆé¢„ç½®è§„æ ¼\"\"\"\n    for req in requirements_list:\n\
          \        if req['service'] in ['eip', 'slb']:\n            # æå–å½“å‰å¸¦å®½å€¼\n\
          \            current_bandwidth = None\n            \n            # ä»propertiesä¸­è·å–å¸¦å®½\n\
          \            if 'properties' in req and 'bandwidth' in req['properties']:\n\
          \                current_bandwidth = req['properties']['bandwidth']\n            # ä»specä¸­è§£æå¸¦å®½\n\
          \            elif 'spec' in req:\n                try:\n                    spec_str = str(req['spec']).replace('M', '').replace('m', '')\n                    current_bandwidth = int(spec_str)\n                except:\n                    current_bandwidth = None\n            \n            # æ ‡å‡†åŒ–å¸¦å®½è§„æ ¼\n\
          \            if current_bandwidth:\n                standard_bandwidth = select_bandwidth_spec(current_bandwidth)\n\
          \                req['spec'] = f\"{standard_bandwidth}M\"\n                if 'properties' not in req:\n                    req['properties'] = {}\n                req['properties']['bandwidth'] = standard_bandwidth\n                \n                # å¦‚æœæ˜¯å‘ä¸Šè°ƒæ•´ï¼Œæ·»åŠ è¯´æ˜\n\
          \                if standard_bandwidth > current_bandwidth:\n                    original_reason = req.get('reason', '')\n                    req['reason'] = f\"å·²è°ƒæ•´ä¸ºæ ‡å‡†è§„æ ¼{standard_bandwidth}M\"\n    return requirements_list\n\ndef normalize_storage_specs(requirements_list):\n\
          \    \"\"\"æ ‡å‡†åŒ–å­˜å‚¨è§„æ ¼ï¼Œç³»ç»Ÿç›˜100GåŸºç¡€ä¸ŠæŒ‰50GBé€’å¢ï¼Œæ•°æ®ç›˜æŒ‰50GBé€’å¢\"\"\"\n    for req in requirements_list:\n\
          \        if req['service'] in ['system_disk', 'data_disk']:\n            # æå–å½“å‰å®¹é‡å€¼\n\
          \            current_size = None\n            \n            # ä»propertiesä¸­è·å–å®¹é‡\n\
          \            if 'properties' in req and 'size' in req['properties']:\n\
          \                current_size = req['properties']['size']\n            # ä»specä¸­è§£æå®¹é‡\n\
          \            elif 'spec' in req:\n                try:\n                    spec_str = str(req['spec']).replace('GB', '').replace('G', '')\n                    current_size = int(spec_str)\n                except:\n                    current_size = None\n            \n            # æ ‡å‡†åŒ–å­˜å‚¨è§„æ ¼\n\
          \            if current_size:\n                is_system_disk = req['service'] == 'system_disk'\n                standard_size = normalize_storage_spec(current_size, is_system_disk)\n\
          \                req['spec'] = f\"{standard_size}GB\"\n                if 'properties' not in req:\n                    req['properties'] = {}\n                req['properties']['size'] = standard_size\n                \n                # æ›´æ–°æ€»å®¹é‡\n                if 'total_capacity' in req['properties']:\n                    req['properties']['total_capacity'] = standard_size * req['quantity']\n                \n                # å¦‚æœæ˜¯å‘ä¸Šè°ƒæ•´ï¼Œæ·»åŠ è¯´æ˜\n\
          \                if standard_size > current_size:\n                    req['reason'] = f\"å·²è°ƒæ•´ä¸ºæ ‡å‡†è§„æ ¼{standard_size}GB\"\n    return requirements_list\n\ndef get_spec_capacity(spec_name):\n\
          \    \"\"\"è·å–è§„æ ¼å¯¹åº”çš„æœåŠ¡å™¨å®¹é‡\"\"\"\n    capacity_map = {\n        \"license_1\"\
          : 1,\n        \"license_10\": 10,\n        \"license_20\": 20,\n       \
          \ \"license_50\": 50\n    }\n    return capacity_map.get(spec_name, 1)\n\ndef format_properties_text_chinese(properties):\n\
          \    \"\"\"å°†å±æ€§è½¬æ¢ä¸ºä¸­æ–‡æ ¼å¼çš„æ–‡æœ¬\"\"\"\n    if not properties:\n        return \"\"\n    \n    # ä¸­æ–‡å±æ€§æ˜ å°„\n    chinese_mapping = {\n        'environment': 'ç¯å¢ƒ',\n        'server_role': 'æœåŠ¡å™¨è§’è‰²',\n        'size': 'å®¹é‡',\n        'disk_type': 'ç£ç›˜ç±»å‹',\n        'total_capacity': 'æ€»å®¹é‡',\n        'bandwidth': 'å¸¦å®½',\n        'max_servers': 'æœ€å¤§æœåŠ¡å™¨æ•°',\n        'covers': 'è¦†ç›–æœåŠ¡å™¨æ•°',\n        'coverage': 'è¦†ç›–èŒƒå›´',\n        'cpu': 'CPUæ ¸æ•°',\n        'memory': 'å†…å­˜',\n        'usage': 'ç”¨é€”'\n    }\n    \n    # ä¸­æ–‡å€¼æ˜ å°„\n    value_mapping = {\n        'production': 'ç”Ÿäº§ç¯å¢ƒ',\n        'development': 'å¼€å‘ç¯å¢ƒ',\n        'testing': 'æµ‹è¯•ç¯å¢ƒ',\n        'application_server': 'åº”ç”¨æœåŠ¡å™¨',\n        'database_server': 'æ•°æ®åº“æœåŠ¡å™¨',\n        'web_server': 'WebæœåŠ¡å™¨',\n        'HDDé«˜é€Ÿäº‘ç›˜': 'HDDé«˜é€Ÿäº‘ç›˜',\n        'SSDäº‘ç›˜': 'SSDäº‘ç›˜'\n    }\n    \n    prop_parts = []\n    for key, value in properties.items():\n        if value:\n            chinese_key = chinese_mapping.get(key, key)\n            chinese_value = value_mapping.get(str(value), str(value))\n            \n            # ç‰¹æ®Šæ ¼å¼åŒ–\n            if key == 'size' and isinstance(value, (int, float)):\n                chinese_value = f\"{value}GB\"\n            elif key == 'total_capacity' and isinstance(value, (int, float)):\n                chinese_value = f\"{value}GB\"\n            elif key == 'bandwidth' and isinstance(value, (int, float)):\n                chinese_value = f\"{value}M\"\n            elif key in ['cpu', 'memory'] and isinstance(value, (int, float)):\n                unit = 'æ ¸' if key == 'cpu' else 'GB'\n                chinese_value = f\"{value}{unit}\"\n            elif key in ['max_servers', 'covers'] and isinstance(value, (int, float)):\n                chinese_value = f\"{value}å°\"\n            \n            prop_parts.append(f\"{chinese_key}: {chinese_value}\")\n    \n    return \", \".join(prop_parts)\n\ndef calculate_optimal_security_specs(total_servers):\n\
          \    \"\"\"è®¡ç®—æœ€ä¼˜çš„å®‰å…¨æœåŠ¡è§„æ ¼ç»„åˆ\"\"\"\n    specs = [50, 20, 10, 1]  # ä»å¤§åˆ°å°çš„è§„æ ¼\n    result = []\n    remaining = total_servers\n    \n    for spec in specs:\n        if remaining >= spec:\n            count = remaining // spec\n            if count > 0:\n                result.append({\n                    'spec': f'license_{spec}',\n                    'quantity': count,\n                    'covers': spec * count,\n                    'max_servers': spec\n                })\n                remaining -= spec * count\n    \n    return result\n\
          \ndef format_spec_display(service_name, spec, properties):\n    \"\"\"æ ¼å¼åŒ–è§„æ ¼æ˜¾ç¤ºä¿¡æ¯\"\
          \"\"\n    try:\n        if service_name == 'ecs':\n            specs_map\
          \ = {\n                \"ecs.t5.small\": \"é€šç”¨å‹ 2æ ¸4GB\",\n              \
          \  \"ecs.t5.medium\": \"é€šç”¨å‹ 4æ ¸8GB\", \n                \"ecs.c5.large\"\
          : \"è®¡ç®—ä¼˜åŒ–å‹ 8æ ¸16GB\",\n                \"4C8G\": \"é€šç”¨å‹ 4æ ¸8GB\"\n         \
          \   }\n            return specs_map.get(str(spec), str(spec))\n        elif\
          \ service_name in ['system_disk', 'data_disk']:\n            size = properties.get('size',\
          \ spec)\n            return f\"{size}GB HDDé«˜é€Ÿäº‘ç›˜\"\n        elif service_name\
          \ in ['eip', 'slb']:\n            bandwidth = properties.get('bandwidth',\
          \ spec)\n            return f\"{bandwidth}Må¸¦å®½\"\n        elif service_name\
          \ in ['bastion_host', 'host_security']:\n            # è·å–æœåŠ¡å™¨æ•°é‡\n\
          \            max_servers = properties.get('max_servers', get_spec_capacity(str(spec)))\n            specs_map = {\n   \
          \             \"license_1\": f\"{max_servers}å°æœåŠ¡å™¨æˆæƒ\",\n                \"license_10\"\
          : f\"{max_servers}å°æœåŠ¡å™¨æˆæƒ\", \n                \"license_20\": f\"{max_servers}å°æœåŠ¡å™¨æˆæƒ\",\n        \
          \        \"license_50\": f\"{max_servers}å°æœåŠ¡å™¨æˆæƒ\",\n                \"basic\": f\"{max_servers}å°æœåŠ¡å™¨æˆæƒ\"\
          \n            }\n            return specs_map.get(str(spec), f\"{max_servers}å°æœåŠ¡å™¨æˆæƒ\")\n\
          \        return str(spec) if spec else ''\n    except:\n        return str(spec)\
          \ if spec else ''\n\ndef safe_extract_properties(properties):\n    \"\"\"\
          å®‰å…¨æå–å±æ€§ä¿¡æ¯ï¼Œé¿å…æ·±åº¦åµŒå¥—\"\"\"\n    if not isinstance(properties, dict):\n      \
          \  return {}\n    \n    safe_props = {}\n    for key, value in properties.items():\n\
          \        if isinstance(value, (str, int, float, bool)):\n            safe_props[key]\
          \ = value\n        elif value is None:\n            safe_props[key] = None\n\
          \        else:\n            safe_props[key] = str(value)\n    return safe_props\n\
          \ndef main(requirements: dict, parse_info: str, success: str) -> dict:\n\
          \    \"\"\"ç”Ÿæˆæœ€ç»ˆçš„é…ç½®æ¸…å•\"\"\"\n    try:\n        if success != \"true\":\n\
          \            return {\n                \"config_list\": None,\n        \
          \        \"response_text\": \"æŠ±æ­‰ï¼Œæˆ‘æ²¡æœ‰ç†è§£æ‚¨çš„éœ€æ±‚ã€‚è¯·æè¿°æ‚¨éœ€è¦çš„äº‘æœåŠ¡ï¼Œä¾‹å¦‚ï¼š'æˆ‘éœ€è¦2å°äº‘æœåŠ¡å™¨ï¼Œ4æ ¸8GBé…ç½®'\"\
          \n            }\n\n        requirements_list = requirements.get(\"list\"\
          , []) if isinstance(requirements, dict) else []\n\n        if not requirements_list:\n\
          \            return {\n                \"config_list\": None,\n        \
          \        \"response_text\": \"æŠ±æ­‰ï¼Œæˆ‘æ²¡æœ‰ç†è§£æ‚¨çš„éœ€æ±‚ã€‚è¯·æè¿°æ‚¨éœ€è¦çš„äº‘æœåŠ¡ï¼Œä¾‹å¦‚ï¼š'æˆ‘éœ€è¦2å°äº‘æœåŠ¡å™¨ï¼Œ4æ ¸8GBé…ç½®'\"\
          \n            }\n\n        # æ ‡å‡†åŒ–å¸¦å®½è§„æ ¼\n        requirements_list = normalize_bandwidth_specs(requirements_list)\n        \n        # æ ‡å‡†åŒ–å­˜å‚¨è§„æ ¼\n        requirements_list = normalize_storage_specs(requirements_list)\n        \n        # ç§»é™¤AIå¯èƒ½è¿”å›çš„é”™è¯¯å®‰å…¨æœåŠ¡é…ç½®ï¼Œç¡®ä¿ä½¿ç”¨å¼ºåˆ¶è®¡ç®—çš„æ­£ç¡®é…ç½®\n        requirements_list = [req for req in requirements_list if req.get('service') not in ['bastion_host', 'host_security']]\n        \n        # åº”ç”¨å¼ºåˆ¶è§„åˆ™\n        additional_services = apply_mandatory_rules(requirements_list)\n\
          \        all_requirements = requirements_list + additional_services\n        \n        # å†æ¬¡æ ‡å‡†åŒ–æ‰€æœ‰æœåŠ¡çš„è§„æ ¼ï¼ˆåŒ…æ‹¬è‡ªåŠ¨æ·»åŠ çš„æœåŠ¡ï¼‰\n        all_requirements = normalize_bandwidth_specs(all_requirements)\n        all_requirements = normalize_storage_specs(all_requirements)\n\n\
          \        # æœåŠ¡ç›®å½•\n        services_catalog = {\n            \"ecs\": {\"\
          name\": \"äº‘æœåŠ¡å™¨ECS\", \"category\": \"compute\"},\n            \"system_disk\"\
          : {\"name\": \"ç³»ç»Ÿç›˜\", \"category\": \"storage\"},\n            \"data_disk\"\
          : {\"name\": \"æ•°æ®ç›˜\", \"category\": \"storage\"},\n            \"eip\":\
          \ {\"name\": \"å¼¹æ€§å…¬ç½‘IP\", \"category\": \"network\"},\n            \"slb\"\
          : {\"name\": \"è´Ÿè½½å‡è¡¡SLB\", \"category\": \"network\"},\n            \"bastion_host\"\
          : {\"name\": \"å ¡å’æœº\", \"category\": \"security\"},\n            \"host_security\"\
          : {\"name\": \"ä¸»æœºå®‰å…¨\", \"category\": \"security\"}\n        }\n\n      \
          \  # ç”Ÿæˆè¯¦ç»†çš„é…ç½®é¡¹åˆ—è¡¨\n        detailed_items = []\n        compute_items = []\n\
          \        storage_items = []\n        network_items = []\n        security_items\
          \ = []\n\n        for req in all_requirements:\n            service_info\
          \ = services_catalog.get(req['service'], {})\n            category = req.get('category',\
          \ service_info.get('category', 'other'))\n\n            # å®‰å…¨æå–å±æ€§\n     \
          \       safe_props = safe_extract_properties(req.get('properties', {}))\n\
          \n            # å°†propertiesè½¬æ¢ä¸ºä¸­æ–‡æ ¼å¼çš„æ–‡æœ¬\n            properties_text = format_properties_text_chinese(safe_props)\n\n       \
          \     # åˆ›å»ºè¯¦ç»†çš„é…ç½®é¡¹\n            item = {\n                'service_name':\
          \ req['service'],\n                'service_display_name': service_info.get('name',\
          \ req['service']),\n                'spec_name': str(req['spec']),\n   \
          \             'spec_display_name': format_spec_display(req['service'], req['spec'],\
          \ safe_props),\n                'quantity': int(req['quantity']),\n    \
          \            'auto_added': bool(req.get('auto_added', False)),\n       \
          \         'reason': str(req.get('reason', '')),\n                'category':\
          \ category,\n                'properties_text': properties_text\n      \
          \      }\n\n            detailed_items.append(item)\n\n            # æŒ‰ç±»åˆ«åˆ†ç»„\n\
          \            if category == 'compute':\n                compute_items.append(item)\n\
          \            elif category == 'storage':\n                storage_items.append(item)\n\
          \            elif category == 'network':\n                network_items.append(item)\n\
          \            elif category == 'security':\n                security_items.append(item)\n\
          \n        # è®¡ç®—è¯¦ç»†æ±‡æ€»ä¿¡æ¯\n        total_ecs = sum(item['quantity'] for item\
          \ in compute_items if item['service_name'] == 'ecs')\n        \n       \
          \ # è®¡ç®—å­˜å‚¨æ€»å®¹é‡\n        total_storage = 0\n        storage_breakdown = {}\n\
          \        for item in storage_items:\n            # ä»properties_textä¸­æå–total_capacityï¼Œæˆ–è€…ä»specè®¡ç®—\n\
          \            capacity = 0\n            if 'total_capacity:' in item['properties_text']:\n\
          \                # å°è¯•ä»properties_textä¸­æå–total_capacity\n               \
          \ try:\n                    for part in item['properties_text'].split(',\
          \ '):\n                        if part.startswith('total_capacity:'):\n\
          \                            capacity = int(part.split(':')[1].strip())\n\
          \                            break\n                except:\n          \
          \          pass\n\n            # å¦‚æœæ²¡æœ‰æ‰¾åˆ°total_capacityï¼Œä»specè®¡ç®—\n        \
          \    if capacity == 0:\n                try:\n                    capacity\
          \ = int(str(item['spec_name']).replace('GB', '')) * item['quantity']\n \
          \               except:\n                    capacity = 0\n\n          \
          \  total_storage += capacity\n            storage_breakdown[item['service_name']]\
          \ = capacity\n        \n \
          \       # åˆ›å»ºå®Œæ•´çš„é…ç½®æ¸…å• - æ§åˆ¶åœ¨5å±‚åµŒå¥—ä»¥å†…\n        config_list = {\n            'config_id':\
          \ \"CONFIG-\" + datetime.now().strftime('%Y%m%d%H%M%S'),\n            'created_at':\
          \ datetime.now().isoformat(),\n            'total_items': len(detailed_items),\n\
          \            'items': detailed_items,\n            'categorized_summary':\
          \ {\n                'compute': {\n                    'count': len(compute_items),\n\
          \                    'total_quantity': sum(item['quantity'] for item in\
          \ compute_items)\n                },\n                'storage': {\n   \
          \                 'count': len(storage_items),\n                    'total_capacity':\
          \ total_storage,\n                    'total_quantity': sum(item['quantity']\
          \ for item in storage_items)\n                },\n                'network':\
          \ {\n                    'count': len(network_items),\n                \
          \    'total_quantity':\
          \ sum(item['quantity'] for item in network_items)\n                },\n\
          \                'security': {\n                    'count': len(security_items),\n\
          \                    'total_quantity': sum(item['quantity'] for item in\
          \ security_items)\n                }\n            },\n            'summary':\
          \ {\n                'total_ecs': total_ecs,\n                'total_storage_capacity':\
          \ total_storage\n \
          \           }\n        }\n\n        # ç”Ÿæˆè¯¦ç»†çš„å“åº”æ–‡æœ¬\n        response_parts\
          \ = []\n\n        if parse_info:\n            response_parts.append(parse_info\
          \ + \"\\n\")\n\n        response_parts.append(\"æ ¹æ®æ‚¨çš„éœ€æ±‚ï¼Œæˆ‘ä¸ºæ‚¨æ¨èä»¥ä¸‹äº‘æœåŠ¡é…ç½®ï¼š\\n\"\
          )\n        \n        # æŒ‰ç±»åˆ«æ˜¾ç¤ºæœåŠ¡\n        category_names = {\n           \
          \ 'compute': '\U0001F4BB è®¡ç®—æœåŠ¡',\n            'storage': '\U0001F4BE å­˜å‚¨æœåŠ¡',\
          \ \n            'network': '\U0001F310 ç½‘ç»œæœåŠ¡',\n            'security': '\U0001F512\
          \ å®‰å…¨æœåŠ¡'\n        }\n\n        # æŒ‰ç±»åˆ«è¯¦ç»†æ˜¾ç¤º\n        for category in ['compute',\
          \ 'storage', 'network', 'security']:\n            category_items = [item\
          \ for item in detailed_items if item['category'] == category]\n        \
          \    if category_items:\n                response_parts.append(f\"\\n{category_names.get(category,\
          \ category)}:\")\n                \n                if category == 'security':\n                    # å®‰å…¨æœåŠ¡éœ€è¦æŒ‰æœåŠ¡åç§°åˆ†ç»„æ˜¾ç¤º\n                    security_groups = {}\n                    for item in category_items:\n                        service_name = item['service_display_name']\n                        if service_name not in security_groups:\n                            security_groups[service_name] = []\n                        security_groups[service_name].append(item)\n                    \n                    for service_name, items in security_groups.items():\n                        if len(items) == 1:\n                            # å•ä¸€è§„æ ¼\n                            item = items[0]\n                            spec_info = f\" - {item['spec_display_name']}\" if item['spec_display_name'] else \"\"\n                            response_parts.append(f\"â€¢ {service_name}{spec_info} Ã— {item['quantity']}\")\n                        else:\n                            # å¤šè§„æ ¼ç»„åˆ\n                            spec_parts = []\n                            for item in items:\n                                spec_parts.append(f\"{item['spec_display_name']}Ã—{item['quantity']}\")\n                            response_parts.append(f\"â€¢ {service_name} - {' + '.join(spec_parts)}\")\n                else:\n                    # å…¶ä»–ç±»åˆ«æ­£å¸¸æ˜¾ç¤º\n                    for item in category_items:\n                        spec_info = f\" - {item['spec_display_name']}\" if item['spec_display_name'] else \"\"\n                        response_parts.append(f\"â€¢ {item['service_display_name']}{spec_info} Ã— {item['quantity']}\")\n\n        # æ·»åŠ è¯¦ç»†æ±‡æ€»ä¿¡æ¯\n        summary = config_list['summary']\n    \
          \    response_parts.append(f\"\\n\U0001F4CA é…ç½®æ±‡æ€»:\")\n        response_parts.append(f\"\
          â€¢ äº‘æœåŠ¡å™¨æ€»æ•°: {summary['total_ecs']}å°\")\n        response_parts.append(f\"\
          â€¢ å­˜å‚¨æ€»å®¹é‡: {summary['total_storage_capacity']}GB\")\n\n        # å­˜å‚¨æ˜ç»†\n  \
          \      if storage_breakdown:\n            storage_details = []\n       \
          \     for service, capacity in storage_breakdown.items():\n            \
          \    service_name = services_catalog.get(service, {}).get('name', service)\n\
          \                storage_details.append(f\"{service_name}{capacity}GB\"\
          )\n            response_parts.append(f\"  å­˜å‚¨æ˜ç»†: {', '.join(storage_details)}\"\
          )\n\n        # ç½‘ç»œæœåŠ¡æ±‡æ€»\n        network_summary = []\n        for item in network_items:\n            service_name = services_catalog.get(item['service_name'], {}).get('name', item['service_name'])\n            network_summary.append(f\"{service_name}{item['quantity']}ä¸ª\")\n        if network_summary:\n            response_parts.append(f\"â€¢ ç½‘ç»œæœåŠ¡: {', '.join(network_summary)}\")\n\n        # å®‰å…¨æœåŠ¡æ±‡æ€»\n        security_summary = []\n        security_groups = {}\n        for item in security_items:\n            service_name = services_catalog.get(item['service_name'], {}).get('name', item['service_name'])\n            if service_name not in security_groups:\n                security_groups[service_name] = 0\n            security_groups[service_name] += item['quantity']\n        \n        for service_name, total_quantity in security_groups.items():\n            security_summary.append(f\"{service_name}{total_quantity}ä¸ª\")\n        if security_summary:\n            response_parts.append(f\"â€¢ å®‰å…¨æœåŠ¡: {', '.join(security_summary)}\")\n\n        response_text = \"\\n\".join(response_parts)\n\n        return\
          \ {\n            \"config_list\": config_list,\n            \"response_text\"\
          : response_text\n        }\n    except Exception as e:\n        return {\n\
          \            \"config_list\": None,\n            \"response_text\": f\"\
          ç”Ÿæˆé…ç½®æ¸…å•æ—¶å‘ç”Ÿé”™è¯¯: {str(e)}\"\n        }"
        code_language: python3
        desc: é…ç½®æ¸…å•ç”Ÿæˆå™¨ - åº”ç”¨ä¸šåŠ¡è§„åˆ™è¿›è¡Œè§„æ ¼æ ‡å‡†åŒ–ã€å¼ºåˆ¶ä¾èµ–è¡¥å…¨ï¼Œç”Ÿæˆè¯¦ç»†çš„äº‘æœåŠ¡é…ç½®æ¸…å•å’Œç”¨æˆ·å‹å¥½çš„å±•ç¤ºæ–‡æœ¬
        outputs:
          config_list:
            children: null
            type: object
          response_text:
            children: null
            type: string
        selected: true
        title: é…ç½®æ¸…å•ç”Ÿæˆ
        type: code
        variables:
        - value_selector:
          - process
          - requirements
          variable: requirements
        - value_selector:
          - process
          - parse_info
          variable: parse_info
        - value_selector:
          - process
          - success
          variable: success
      height: 82
      id: generate
      position:
        x: 1550
        y: 272
      positionAbsolute:
        x: 1550
        y: 272
      selected: true
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ç»“æœè¾“å‡ºèŠ‚ç‚¹ - å‘ç”¨æˆ·å±•ç¤ºæœ€ç»ˆç”Ÿæˆçš„äº‘æœåŠ¡é…ç½®æ¸…å•å’Œè¯¦ç»†çš„é…ç½®è¯´æ˜æ–‡æœ¬
        outputs:
        - value_selector:
          - generate
          - response_text
          value_type: string
          variable: response_text
        - value_selector:
          - generate
          - config_list
          value_type: object
          variable: config_list
        selected: false
        title: è¾“å‡ºç»“æœ
        type: end
      height: 144
      id: end
      position:
        x: 1854
        y: 272
      positionAbsolute:
        x: 1854
        y: 272
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    viewport:
      x: -169.0437848949191
      y: 22.955854142123542
      zoom: 0.6093853943072869
