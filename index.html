<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>云需求顾问 - 云服务报价助手</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="app.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body class="bg-gradient-to-b from-slate-50 to-white min-h-screen">
  <div class="app">
    <header class="app-header">
      <div class="brand">
        <i class="fa-solid fa-cloud"></i>
        <div class="brand-text">
          <h1>云需求顾问</h1>
          <p>智能云服务配置与清单生成</p>
        </div>
      </div>
      <div class="header-meta">
        <span id="apiEndpoint" class="meta-item" title="API 端点">加载配置中...</span>
        <span class="dot">•</span>
        <span id="authType" class="meta-item" title="认证方式">...</span>
        <span id="authStatus" class="auth-badge missing"><i class="fa-solid fa-circle-exclamation"></i> 缺失</span>
        <button id="openSettings" class="icon-btn settings-btn" title="API 配置">
          <i class="fa-solid fa-gear"></i>
        </button>
        <button id="openRules" class="icon-btn" title="规则清单">
          <i class="fa-solid fa-list-check"></i>
          <span style="margin-left:6px; font-weight:600;">规则清单</span>
        </button>
      </div>
    </header>

    <main class="app-main">
      <!-- 输入卡片 -->
      <section class="panel" id="section-config">
        <div class="panel-body">
          <div class="card !p-4 sm:!p-5 space-y-3">
            <h3 class="card-title"><i class="fa-regular fa-rectangle-list"></i> 需求输入</h3>
            <label class="field-label" for="userRequirement">请描述您的云服务需求</label>
            <textarea id="userRequirement" class="textarea !min-h-[120px] !p-3" rows="5" placeholder="例如：2 个应用系统，共 13 台 8C16G 云服务器，配置系统盘 140G，数据盘 180G，分别配置 30M 出口带宽，给我配置清单"></textarea>
            <div class="suggested-questions">
              <div class="sugg-title">建议问题</div>
              <div class="sugg-list" id="suggestionsContainer"></div>
            </div>
            <button id="submitBtn" class="btn primary w-full !py-3">
              <i class="fa-solid fa-paper-plane"></i>
              生成配置清单
            </button>
          </div>
        </div>
      </section>

      <!-- 需求分析总结 -->
      <section class="panel" id="section-summary">
        <div class="panel-body">
          <div class="card !p-4 sm:!p-5">
            <h3 class="card-title"><i class="fa-regular fa-note-sticky"></i> 需求分析总结</h3>
            <div id="summaryContent" class="summary-content whitespace-pre-line text-[14px] leading-7 bg-slate-50 border border-slate-200 rounded-md p-3"></div>
          </div>
        </div>
      </section>

      <!-- 配置清单汇总（独立区域） -->
      <section class="panel" id="section-config-summary">
        <div class="panel-body">
          <div class="card !p-4 sm:!p-5">
            <h3 class="card-title"><i class="fa-solid fa-chart-pie"></i> 配置清单汇总</h3>
            <div id="configSummaryPanel" class="summary-grid"></div>
          </div>
        </div>
      </section>

      <!-- 详细配置清单 -->
      <section class="panel" id="section-result">
        <div class="panel-body">
          <div class="card !p-4 sm:!p-5">
            <div class="card-header-row flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
              <h3 class="card-title m-0"><i class="fa-regular fa-clipboard"></i> 详细配置清单</h3>
              <!-- 按钮两行布局：小屏自动换行，桌面同行靠右 -->
              <div class="actions flex flex-wrap gap-2 sm:justify-end">
                <div class="flex gap-2">
                  <button id="cardViewBtn" class="btn chip active"><i class="fa-solid fa-grip"></i> 卡片视图</button>
                  <button id="tableViewBtn" class="btn chip"><i class="fa-solid fa-table"></i> 表格视图</button>
                </div>
                <div class="flex gap-2 w-full sm:w-auto justify-between sm:justify-start">
                  <button id="exportExcelBtn" class="btn chip w-full sm:w-auto"><i class="fa-regular fa-file-excel"></i> 导出 Excel</button>
                </div>
              </div>
            </div>

            <div class="tabs">
              <button class="tab-btn active" data-category="all">全部</button>
              <button class="tab-btn" data-category="compute"><i class="fa-solid fa-server"></i> 计算</button>
              <button class="tab-btn" data-category="storage"><i class="fa-solid fa-database"></i> 存储</button>
              <button class="tab-btn" data-category="network"><i class="fa-solid fa-network-wired"></i> 网络</button>
              <button class="tab-btn" data-category="security"><i class="fa-solid fa-shield-halved"></i> 安全</button>
            </div>

            <div class="config-head">
              <div class="info-left">
                <span id="configId" class="muted"></span>
                <span class="dot">•</span>
                <span id="configTime" class="muted"></span>
              </div>
              <div class="info-right">
                <span id="totalItems" class="muted"></span>
              </div>
            </div>

            <div id="configItems" class="config-items"></div>

            <div id="configTableContainer" class="table-wrap hidden">
              <table class="table">
                <thead>
                  <tr>
                    <th>服务类型</th>
                    <th>服务名称</th>
                    <th>规格</th>
                    <th>数量</th>
                    <th>属性</th>
                    <th>说明</th>
                    <th>自动添加</th>
                  </tr>
                </thead>
                <tbody id="configTableBody"></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- 设置弹窗 -->
    <div id="settingsModal" class="modal hidden">
      <div class="modal-backdrop" data-close="1"></div>
      <div class="modal-dialog">
        <div class="modal-header">
          <h3>API 配置</h3>
          <button id="closeSettings" class="icon-btn" aria-label="关闭">
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-row">
            <label class="field-label" for="apiKey">API Key</label>
            <div class="input-with-button">
              <input type="password" id="apiKey" class="input" placeholder="请输入您的 API Key" />
              <button id="toggleApiKey" class="icon-btn" title="显示/隐藏 API Key">
                <i class="fa-regular fa-eye"></i>
              </button>
            </div>
          </div>
          <div class="form-row">
            <label class="field-label" for="workflowId">工作流 ID（可选）</label>
            <input type="text" id="workflowId" class="input" placeholder="不填则使用默认工作流" />
          </div>
          <div class="form-row">
            <label class="field-label" for="customBaseUrl">自定义 API 端点</label>
            <input type="text" id="customBaseUrl" class="input" placeholder="留空则使用 config.json 的 baseUrl" />
          </div>
        </div>
        <div class="modal-footer">
          <button id="saveSettings" class="btn primary"><i class="fa-solid fa-floppy-disk"></i> 保存</button>
        </div>
      </div>
    </div>

    <!-- 动态规则配置弹窗 -->
    <div id="rulesModal" class="modal hidden">
      <div class="modal-backdrop" data-close="1"></div>
      <div class="modal-dialog max-w-5xl">
        <div class="modal-header">
          <h3>动态规则</h3>
          <button id="closeRules" class="icon-btn" aria-label="关闭">
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="flex flex-wrap items-center gap-2 mb-3">
            <div class="flex gap-2">
              <button id="rulesTableBtn" class="btn chip active"><i class="fa-solid fa-table"></i> 表格视图</button>
              <button id="rulesJsonBtn" class="btn chip"><i class="fa-solid fa-code"></i> JSON 文本</button>
            </div>
            <div id="rulesFilterWrap" class="flex items-center gap-2 ml-auto">
              <label for="rulesServiceFilter" class="field-label" style="margin:0">云服务</label>
              <select id="rulesServiceFilter" class="input" style="width:auto;min-width:200px"></select>
            </div>
          </div>
          <div id="rulesTableSection" class="table-wrap">
            <table class="table">
              <thead>
                <tr>
                  <th>服务名称</th>
                  <th>分类</th>
                  <th>规格名称</th>
                </tr>
              </thead>
              <tbody id="rulesTableBody"></tbody>
            </table>
          </div>
          <div id="rulesJsonSection" class="hidden">
            <pre id="rulesJsonText" class="text-[12px] leading-5 bg-slate-50 border border-slate-200 rounded-md p-3 whitespace-pre overflow-auto max-h-[60vh]"></pre>
          </div>
        </div>
        <div class="modal-footer">
          <span class="muted">来源：dynamic_rules.json</span>
        </div>
      </div>
    </div>

    <div id="errorMessage" class="toast hidden">
      <div class="toast-content">
        <i class="fa-solid fa-circle-exclamation"></i>
        <div id="errorText" class="toast-text"></div>
        <button id="closeError" class="icon-btn" aria-label="关闭">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html> 